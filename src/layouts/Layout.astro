---
import Nav from "../components/Nav.astro";
import "../styles/global.css";
import "@fontsource-variable/cormorant-garamond";
import "@fontsource-variable/manrope";

interface Props {
    title: string;
    description?: string;
}

const { title, description = "Software Developer â€” Portfolio" } = Astro.props;
const currentPath = Astro.url.pathname;
const canonicalUrl = Astro.url.href;
const ogImagePath = "/og-image.jpeg";
const ogImageUrl = new URL(
    ogImagePath,
    Astro.site ? Astro.site : Astro.url,
).toString();
---

<html lang="en">
    <head>
        <meta charset="utf-8" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <link rel="icon" href="/favicon.ico" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1, viewport-fit=cover"
        />
        <meta name="theme-color" content="#0e0c0a" />
        <meta
            name="theme-color"
            media="(prefers-color-scheme: light)"
            content="#0e0c0a"
        />
        <meta
            name="theme-color"
            media="(prefers-color-scheme: dark)"
            content="#0e0c0a"
        />
        <meta name="description" content={description} />
        <meta name="generator" content={Astro.generator} />
        <meta property="og:type" content="website" />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:url" content={canonicalUrl} />
        <meta property="og:image" content={ogImageUrl} />
        <meta property="og:image:width" content="1600" />
        <meta property="og:image:height" content="960" />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={ogImageUrl} />
        <title>{title}</title>
    </head>

    <body class="bg-deep text-cream font-body antialiased overflow-x-hidden">
        <!-- Ambient atmospheric glows -->
        <div
            class="fixed inset-0 -z-10 overflow-hidden pointer-events-none"
            aria-hidden="true"
        >
            <div
                class="absolute top-[12%] -left-[10%] w-[45%] h-[45%] rounded-full bg-amber/[0.035] blur-[160px] animate-glow-pulse"
            >
            </div>
            <div
                class="absolute bottom-[18%] -right-[8%] w-[35%] h-[35%] rounded-full bg-rose/2.5 blur-[130px] animate-glow-pulse"
                style="animation-delay: 2s;"
            >
            </div>
            <div
                class="absolute top-[55%] left-[25%] w-[28%] h-[28%] rounded-full bg-lavender/[0.018] blur-[110px] animate-glow-pulse"
                style="animation-delay: 3.5s;"
            >
            </div>
        </div>

        <Nav currentPath={currentPath} />

        <main class="site-main">
            <slot />
        </main>

        <button
            type="button"
            class="back-to-top"
            aria-label="Back to top"
            data-back-to-top
            hidden
        >
            <span aria-hidden="true">&#8593;</span>
        </button>

        <!-- Footer -->
        <footer class="relative mt-32 pb-14">
            <div class="divider-shimmer max-w-xs mx-auto mb-10"></div>
            <p
                class="text-center font-display italic text-amber/60 text-base tracking-widest"
            >
                irgendwie, irgendwo, irgendwann
            </p>
        </footer>

        <!-- Scroll reveal observer -->
        <script>
            const reveals = document.querySelectorAll("[data-reveal]");
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry) => {
                        if (entry.isIntersecting) {
                            entry.target.classList.add("revealed");
                            observer.unobserve(entry.target);
                        }
                    });
                },
                { threshold: 0.08, rootMargin: "0px 0px -40px 0px" },
            );
            reveals.forEach((el) => observer.observe(el));

            const backToTopButton = document.querySelector("[data-back-to-top]");

            if (backToTopButton instanceof HTMLButtonElement) {
                const toggleButton = () => {
                    const isVisible = window.scrollY > 320;
                    backToTopButton.classList.toggle("is-visible", isVisible);
                    backToTopButton.hidden = !isVisible;
                };

                toggleButton();
                window.addEventListener("scroll", toggleButton, { passive: true });

                backToTopButton.addEventListener("click", () => {
                    window.scrollTo({ top: 0, behavior: "smooth" });
                });
            }
        </script>
    </body>
</html>
